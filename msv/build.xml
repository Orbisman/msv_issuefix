<?xml version="1.0"?>

<project name="tranquilo" basedir="." default="jars">
	<property name="sourceDir" value="./src"/>
	<property name="testDir" value="./test"/>
	<property name="buildDir" value="./build"/>
	<property name="documentDir" value="./doc/javadoc"/>
	<property name="packageDir" value="./package"/>
	<property name="libDir" value="./lib"/>
	<property name="javaCClib" value="C:\Progra~1\Development\JavaCC\bin\lib" />
	
	<!-- test directory where you put your files like "relaxNNN.rlx" -->
	<property name="RELAXBatchTestDir" value="C:/work/relax;c:/work/NITF;c:/work/JepaX" />
	<property name="TREXBatchTestDir" value="C:/work/trex;c:/work/NITF;c:/work/JepaX" />


	<target name="javacc">
		<!-- run javacc for ISO8601Parser -->
		<javacc	target="${sourceDir}/com/sun/tranquilo/datatype/datetime/ISO8601.jj"
				outputdirectory="${sourceDir}/com/sun/tranquilo/datatype/datetime"
				javacchome="${javaCClib}"
		/>

		<!-- run javacc for UriReference -->
		<javacc	target="${sourceDir}/com/sun/tranquilo/datatype/anyURI.jj"
				outputdirectory="${sourceDir}/com/sun/tranquilo/datatype"
				javacchome="${javaCClib}"
		/>
	</target>
	
	<target name="binary" depends="javacc">
		
		<!-- compile Java source files -->
		<javac srcdir="${sourceDir}" destdir="${buildDir}"/>
	</target>
	
	<!-- generate XSDLib release -->
	<target name="xsd" depends="javacc">
		<tstamp />
		
		<mkdir	dir="xsdrelease" />

		<!-- copy document files -->
		<copy	todir="xsdrelease">
			<fileset dir="doc/datatype" includes="**/*.*" />
		</copy>
				
		<!-- compile files again -->
		<mkdir	dir="temp" />
		<javac	srcdir="${sourceDir}"
				destdir="temp">
			<include name="**/tranquilo/datatype/**/*.java" />
			<include name="**/sun/xml/*.java" />
		</javac>
		<javac	srcdir="${testDir}"
				destdir="temp">
			<include name="com/sun/tranquilo/datatype/CommandLineTester.java" />
		</javac>
		
		<!-- creates binary jar -->
		<jar	jarfile="xsdrelease/xsdlib.jar"
				manifest="./META-INF/XSD.MANIFEST.MF"
				compress="false">
			<fileset dir="${sourceDir}" includes="**/tranquilo/datatype/**/*.properties" />
			<fileset dir="temp" />
			<fileset dir="c:\winnt\java\classes" includes="org/apache/xerces/utils/regex/*.*" />
		</jar>
		
		<delete dir="temp" />
		
		
		<!-- creates javadoc -->
		<mkdir		dir="xsdrelease/javadoc" />
		<javadoc	locale="en_US"
					packagenames="com.sun.tranquilo.datatype.*"
					sourcepath="${sourceDir}"
					destdir="xsdrelease/javadoc"
					windowtitle="XML Schema Part 2 Implementation"
					public="yes"
					>
			<link offline="true" href="http://java.sun.com/products/jdk/1.2/docs/api" packagelistLoc="ExternalPackageLists\CoreAPI" />
			<link offline="true" href="http://xml.apache.org/apiDocs/" packagelistLoc="ExternalPackageLists\XML" />
		</javadoc>
		
		<!-- creates distribution package -->
		<zip	zipfile="${packageDir}/xsdlib.${DSTAMP}.zip">
			<fileset dir="." includes="src/**/tranquilo/datatype/**/*.*" />
			<fileset dir="." includes="src/**/sun/xml/**/*.*" />
			<fileset dir="C:\Program Files\Development\Xerces" includes="src/org/apache/xerces/utils/regex/*.*" />
			<fileset dir="xsdrelease" />
		</zip>
		
		<delete dir="xsdrelease" />
	</target>
	
	
	<!-- generate Tranquilo release -->
	<target name="release" depends="javacc">
		<tstamp />
		
		<mkdir	dir="release" />

		<!-- copy document files -->
		<copy	todir="release">
			<fileset dir="doc/tranquilo" includes="**/*.*" />
		</copy>
				
		<!-- compile files again -->
		<mkdir	dir="temp" />
		<javac	srcdir="${sourceDir}"
				destdir="temp"
				classpath="${libDir}">
			<include name="**/tranquilo/**/*.java" />
			<include name="**/sun/xml/*.java" />
		</javac>
		
		<!-- unzip contents from xerces.jar -->
		<mkdir dir="xerces" />
		<unjar src="c:\winnt\java\classes\xerces.jar" dest="xerces" />
		
		<!-- creates binary jar -->
		<jar	jarfile="release/tranquilo.jar"
				manifest="./META-INF/MANIFEST.MF"
				compress="false">
			<fileset dir="${sourceDir}" includes="**/tranquilo/**/*.properties" />
			<fileset dir="${libDir}" includes="javax/xml/parsers/*.class" />
			<fileset dir="temp" />
			<fileset dir="xerces" includes="org/apache/xerces/**/*.*" />
<!--			<fileset dir="c:\winnt\java\classes" includes="org/apache/xerces/utils/regex/*.*" />	-->
			<fileset dir="c:\winnt\java\classes" includes="org/xml/sax/**/*.class" />
		</jar>
		
		<delete dir="temp" />
		<delete dir="xerces" />
		
		
		<!-- creates javadoc -->
		<mkdir		dir="release/javadoc" />
		<javadoc	locale="en_US"
					packagenames="com.sun.tranquilo.*"
					sourcepath="${sourceDir}"
					destdir="release/javadoc"
					windowtitle="Tranquilo Verifier"
					public="yes"
					>
			<link offline="true" href="http://java.sun.com/products/jdk/1.2/docs/api" packagelistLoc="ExternalPackageLists\CoreAPI" />
			<link offline="true" href="http://xml.apache.org/apiDocs/" packagelistLoc="ExternalPackageLists\XML" />
		</javadoc>
		
		<!-- creates distribution package -->
		<zip	zipfile="${packageDir}/tranquilo.${DSTAMP}.zip">
			<fileset dir="." includes="src/**/tranquilo/**/*.*" />
			<fileset dir="." includes="src/**/sun/xml/**/*.*" />
			<fileset dir="C:\Program Files\Development\Xerces" includes="src/org/apache/xerces/utils/regex/*.*" />
			<fileset dir="release" />
		</zip>
		
		<delete dir="release" />
	</target>
	
	
	<!--  run all the test suites -->
	<target name="test">
		<mkdir dir="./testLog" />
		<!--
			please remove jaxp.jar from ant directory,
			because it uses an old one, and this test needs the latest one
		-->
		<junit haltonfailure="yes" printsummary="yes" fork="yes">
			<sysproperty key="RELAXBatchTestDir"	value="${RELAXBatchTestDir}"/>
			<sysproperty key="TREXBatchTestDir"		value="${TREXBatchTestDir}"/>
			
  			<formatter type="plain" />
			
			<classpath>
				<pathelement location="${buildDir}" />
				<pathelement location="${sourceDir}" />
				<pathelement location="${testDir}" />
				<pathelement path="${java.class.path}" />
			</classpath>
		
			<batchtest todir="./testLog">
				<fileset dir="${buildDir}">
					<include name="**/*Test.class" />
				</fileset>
			</batchtest>
		</junit>
	</target>
	
	
	
	<!-- generate jar files -->
	<target name="jars" depends="binary">
		<tstamp />
		
		<!-- standard archive -->
		<jar	jarfile="${packageDir}/tranquilo.${DSTAMP}.jar"
				manifest="./META-INF/MANIFEST.MF"
				compress="false">
			<fileset dir="${sourceDir}" includes="**/*.properties" />
			<fileset dir="${buildDir}" includes="**/*.class" />
			<fileset dir="${libDir}" includes="**/*.class" />
			<fileset dir="c:/winnt/java/classes" includes="org/apache/**/*, org/xml/**/*, org/w3c/**/*" />
		</jar>
	</target>
	
	<!-- generate javadoc documentation -->
	<target name="javadoc">
		<javadoc	locale="en_US"
					packagenames="com.sun.tranquilo.*"
					sourcepath="${sourceDir}"
					destdir="${documentDir}"
					windowtitle="Tranquilo RELAX/TREX Verifier"
					public="yes"
					>
			<link offline="true" href="http://java.sun.com/products/jdk/1.2/docs/api" packagelistLoc="ExternalPackageLists\CoreAPI" />
			<link offline="true" href="http://xml.apache.org/apiDocs/" packagelistLoc="ExternalPackageLists\XML" />
		</javadoc>
	</target>
</project>
